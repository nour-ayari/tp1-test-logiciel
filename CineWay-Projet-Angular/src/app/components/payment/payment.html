<div class="min-h-screen bg-gray-900 py-12 px-4 sm:px-6 lg:px-8">
  <div class="max-w-4xl mx-auto">
    <!-- Header -->
    <div class="mb-8">
      <button
        (click)="goBack()"
        class="text-gray-400 hover:text-white flex items-center gap-2 mb-4"
        [disabled]="paymentSuccess()"
      >
        <i class="bi bi-arrow-left"></i>
        <span>Back</span>
      </button>
      <h1 class="text-3xl font-bold text-white">Complete Your Payment</h1>
    </div>

    <!-- Timer Warning -->
    @if (timeRemaining() > 0 && timeRemaining() <= 120) {
      <div class="bg-yellow-900/30 border border-yellow-700 rounded-lg p-4 mb-6">
        <div class="flex items-center gap-3">
          <i class="bi bi-clock-history text-yellow-500 text-xl"></i>
          <div>
            <p class="text-yellow-500 font-semibold">Hurry! Time is running out</p>
            <p class="text-yellow-300 text-2xl font-bold">{{ formatTime(timeRemaining()) }}</p>
          </div>
        </div>
      </div>
    }

    <!-- Error Message -->
    @if (paymentError()) {
      <div class="bg-red-900/30 border border-red-700 rounded-lg p-4 mb-6">
        <div class="flex items-center gap-3">
          <i class="bi bi-exclamation-triangle text-red-500 text-xl"></i>
          <p class="text-red-300">{{ paymentError() }}</p>
        </div>
      </div>
    }

    <!-- Success Message -->
    @if (paymentSuccess()) {
      <div class="bg-green-900/30 border border-green-700 rounded-lg p-6 mb-6">
        <div class="flex items-center gap-3 mb-4">
          <i class="bi bi-check-circle text-green-500 text-3xl"></i>
          <div>
            <p class="text-green-300 text-xl font-semibold">Payment Successful!</p>
            <p class="text-green-400">Your tickets have been confirmed. Redirecting...</p>
          </div>
        </div>
        @if (paymentResponse()) {
          <div class="text-gray-300 space-y-1">
            <p>
              <span class="text-gray-400">Payment ID:</span> {{ paymentResponse()!.payment_id }}
            </p>
            <p>
              <span class="text-gray-400">Tickets:</span> {{ paymentResponse()!.tickets?.length }}
            </p>
          </div>
        }
      </div>
    }

    @if (!paymentSuccess()) {
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Left Column: Order Details -->
        <div class="space-y-6">
          <!-- Movie Details -->
          @if (movie()) {
            <div class="bg-gray-800 rounded-lg p-6">
              <h2 class="text-xl font-semibold text-white mb-4">
                <i class="bi bi-film me-2"></i>Movie Details
              </h2>
              <div class="flex gap-4">
                <img
                  [src]="movie()!.image_url"
                  [alt]="movie()!.title"
                  class="w-28 h-40 object-cover rounded-lg shadow-lg"
                />
                <div class="flex-1">
                  <h3 class="text-xl font-semibold text-white mb-2">{{ movie()!.title }}</h3>
                  <div class="text-gray-400 text-sm space-y-2">
                    <p class="flex items-center gap-2">
                      <i class="bi bi-tag"></i>
                      {{ movie()!.genre.join(', ') }}
                    </p>
                    <p class="flex items-center gap-2">
                      <i class="bi bi-clock"></i>
                      {{ movie()!.duration_minutes }} minutes
                    </p>
                    <p class="flex items-center gap-2">
                      <i class="bi bi-star-fill text-yellow-400"></i>
                      {{ movie()!.rating }}
                    </p>
                  </div>
                </div>
              </div>
            </div>
          } @else {
            <div class="bg-gray-800 rounded-lg p-6">
              <h2 class="text-xl font-semibold text-white mb-4">
                <i class="bi bi-film me-2"></i>Movie Details
              </h2>
              <p class="text-gray-400">Loading movie details...</p>
            </div>
          }

          <!-- Selected Seats -->
          <div class="bg-gray-800 rounded-lg p-6">
            <h2 class="text-xl font-semibold text-white mb-4">
              <i class="bi bi-ticket-perforated me-2"></i>
              Selected Seats ({{ ticketCount() }})
            </h2>
            @if (selectedSeats().length > 0) {
              <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                @for (seat of selectedSeats(); track seat.seat_id) {
                  <div class="bg-gray-700 rounded-lg p-3 text-center border border-gray-600">
                    <p class="text-white font-bold text-lg">{{ seat.label }}</p>
                    <p class="text-gray-400 text-xs uppercase">{{ seat.type }}</p>
                    <p class="text-green-400 font-semibold">${{ seat.price.toFixed(2) }}</p>
                  </div>
                }
              </div>
            } @else {
              <p class="text-gray-400">No seats selected</p>
            }
          </div>
        </div>

        <!-- Right Column: Payment Summary -->
        <div>
          <div class="bg-gray-800 rounded-lg p-6 sticky top-4">
            <h2 class="text-xl font-semibold text-white mb-6">
              <i class="bi bi-receipt me-2"></i>Order Summary
            </h2>

            <!-- Price Breakdown -->
            <div class="space-y-4 mb-6">
              <div class="flex justify-between text-gray-300">
                <span>Tickets ({{ ticketCount() }})</span>
                <span>${{ total().toFixed(2) }}</span>
              </div>
              <div class="flex justify-between text-gray-300">
                <span>Service Fee</span>
                <span>${{ serviceFee().toFixed(2) }}</span>
              </div>

              <div class="border-t border-gray-600 pt-4">
                <div class="flex justify-between text-white font-bold text-2xl">
                  <span>Total</span>
                  <span class="text-green-400">${{ finalTotal().toFixed(2) }}</span>
                </div>
              </div>
            </div>

            <!-- Pay Button -->
            <button
              (click)="processPayment()"
              [disabled]="isProcessing() || paymentSuccess() || selectedSeats().length === 0"
              class="w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-bold py-4 px-6 rounded-lg transition-all duration-200 text-lg flex items-center justify-center gap-3 shadow-lg hover:shadow-xl"
            >
              @if (isProcessing()) {
                <i class="bi bi-arrow-repeat animate-spin text-xl"></i>
                <span>Processing Payment...</span>
              } @else {
                <i class="bi bi-credit-card text-xl"></i>
                <span>Pay ${{ finalTotal().toFixed(2) }}</span>
              }
            </button>

            <p class="text-gray-500 text-xs text-center mt-4">
              <i class="bi bi-shield-lock-fill me-1"></i>
              Secure payment processing
            </p>
          </div>
        </div>
      </div>
    }
  </div>
</div>
